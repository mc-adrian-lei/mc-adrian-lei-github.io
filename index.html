<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>32 Aspect Developmental Self Clock ‚Äî Gemini AI Prototype</title>
  <style>
    /* =============================================================
       32 Aspect Developmental Self Clock ‚Äî Mind‚ÄìBody‚ÄìEnergy
       ‚Ä¢ Plain HTML, CSS, and JavaScript (no external libraries)
       ‚Ä¢ Integration: Google Gemini API (v1beta REST) + Web Speech API
       ============================================================= */

    :root {
      color-scheme: light;
      --bg: #f6f7fc;
      --bg-soft: rgba(255, 255, 255, 0.95);
      --panel: rgba(255, 255, 255, 0.9);
      --panel-strong: rgba(255, 255, 255, 0.98);
      --ink: #101327;
      --muted: #5d6786;
      --accent: #1d4ed8;
      --accent-2: #7c3aed;
      --good: #059669;
      --warn: #d97706;
      --bad: #dc2626;
      --ring-line-1: rgba(79, 70, 229, 0.2);
      --ring-line-2: rgba(59, 130, 246, 0.18);
      --stage-line: rgba(37, 99, 235, 0.28);
      --node-label: rgba(28, 35, 64, 0.82);
      --focus: #facc15;
      --input-bg: rgba(248, 249, 255, 0.95);
      --input-border: rgba(148, 163, 233, 0.35);
      --input-border-focus: rgba(37, 99, 235, 0.55);
      --shadow-1: 0 18px 32px rgba(15, 23, 42, 0.12);
      --shadow-2: 0 24px 60px rgba(15, 23, 42, 0.18);
      --glass-stroke: rgba(148, 163, 233, 0.22);
    }

    body[data-theme="dark"] {
      color-scheme: dark;
      --bg: #050914;
      --bg-soft: #0b1230;
      --panel: rgba(18, 22, 45, 0.85);
      --panel-strong: rgba(17, 25, 56, 0.92);
      --ink: #f5f7ff;
      --muted: #b4bcdd;
      --accent: #60a5fa;
      --accent-2: #a855f7;
      --good: #34d399;
      --warn: #fbbf24;
      --bad: #f87171;
      --ring-line-1: rgba(88, 119, 255, 0.22);
      --ring-line-2: rgba(37, 58, 123, 0.28);
      --stage-line: rgba(124, 196, 255, 0.35);
      --node-label: rgba(226, 234, 255, 0.95);
      --input-bg: rgba(20, 26, 53, 0.75);
      --input-border: rgba(102, 126, 234, 0.35);
      --input-border-focus: rgba(144, 160, 255, 0.75);
      --shadow-1: 0 18px 40px rgba(3, 7, 18, 0.45);
      --shadow-2: 0 20px 60px rgba(5, 11, 32, 0.65);
      --glass-stroke: rgba(120, 150, 255, 0.18);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, "Roboto", "Helvetica Neue", sans-serif;
      background:
        radial-gradient(1200px 1200px at 72% 12%, rgba(125, 211, 252, 0.24), transparent),
        radial-gradient(1000px 1000px at 15% 85%, rgba(196, 181, 253, 0.18), transparent),
        linear-gradient(170deg, var(--bg-soft), var(--bg));
      color: var(--ink);
      transition: background 0.6s ease, color 0.4s ease;
    }

    body[data-theme="dark"] {
      background:
        radial-gradient(900px 900px at 85% 18%, rgba(59, 130, 246, 0.18), transparent),
        radial-gradient(720px 720px at 12% 88%, rgba(129, 140, 248, 0.18), transparent),
        linear-gradient(160deg, rgba(9, 12, 28, 0.92), var(--bg));
    }

   .app {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 360px;
      grid-template-rows: auto 1fr auto;
      grid-template-areas:
        "top top"
        "vis side"
        "footer footer";
      gap: 16px;
      height: 100dvh;
      padding: clamp(16px, 2vw, 28px);
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      grid-area: top;
      display: flex;
      flex-direction: column;
      gap: 14px;
      background: var(--panel);
      border: 1px solid var(--glass-stroke);
      border-radius: 20px;
      padding: clamp(16px, 2vw, 24px);
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow-1);
    }

   .header-top {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    header h1 {
      font-size: clamp(18px, 2.4vw, 26px);
      margin: 0;
      letter-spacing: 0.4px;
    }

   .title-block { max-width: min(640px, 100%); }

   .subtitle {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: clamp(12px, 1.6vw, 14px);
      max-width: 60ch;
    }

   .mode-toggle {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

   .control-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

   .control-cluster {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
   .control-cluster.secondary { margin-left: auto; justify-content: flex-end; }

    button { font: inherit; }

   .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 12px;
      border: 1px solid color-mix(in srgb, var(--accent) 40%, transparent);
      background: linear-gradient(140deg,
        color-mix(in srgb, var(--accent) 35%, transparent) 0%,
        color-mix(in srgb, var(--accent-2) 32%, transparent) 100%);
      color: var(--ink);
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.18);
    }
   .btn:hover { transform: translateY(-1px); box-shadow: 0 16px 36px rgba(59, 130, 246, 0.28); }
   .btn:active { transform: translateY(0); }
   .btn:focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; }
   .btn.secondary {
      background: color-mix(in srgb, var(--panel-strong) 92%, transparent);
      border-color: color-mix(in srgb, var(--accent) 25%, transparent);
      box-shadow: none;
    }
   .btn.secondary:hover { background: color-mix(in srgb, var(--panel-strong) 75%, var(--accent) 25%); }
   .btn.warn {
      background: color-mix(in srgb, var(--bad) 45%, transparent 55%);
      border-color: color-mix(in srgb, var(--bad) 60%, transparent);
      box-shadow: none;
    }
   .btn.warn:hover { background: color-mix(in srgb, var(--bad) 60%, transparent 40%); }
   .btn.ghost {
      background: transparent;
      border-color: color-mix(in srgb, var(--muted) 26%, transparent);
      color: var(--muted);
      box-shadow: none;
    }
   .btn.ghost:hover { color: var(--ink); border-color: color-mix(in srgb, var(--accent) 40%, transparent); }
   .btn.tertiary {
      background: color-mix(in srgb, var(--accent) 18%, transparent);
      border-color: color-mix(in srgb, var(--accent) 35%, transparent);
      color: var(--ink);
      box-shadow: none;
    }
   .btn.small { padding: 6px 12px; font-size: 12px; }

   .vis {
      grid-area: vis;
      position: relative;
      background: linear-gradient(165deg,
        color-mix(in srgb, var(--panel-strong) 92%, transparent) 0%,
        color-mix(in srgb, var(--bg) 75%, transparent) 100%);
      border-radius: 24px;
      border: 1px solid var(--glass-stroke);
      display: grid;
      grid-template-rows: 1fr auto;
      overflow: clip;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-2);
    }

    canvas { width: 100%; height: 100%; display: block; }

   .legend {
      padding: 16px;
      border-top: 1px solid color-mix(in srgb, var(--accent) 22%, transparent);
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      background: color-mix(in srgb, var(--panel) 90%, transparent);
    }

   .legend.chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid color-mix(in srgb, var(--accent) 25%, transparent);
      border-radius: 999px;
      padding: 6px 12px;
      color: var(--muted);
      background: color-mix(in srgb, var(--panel-strong) 85%, transparent);
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.2px;
    }

   .legend.swatch {
      width: 12px;
      height: 12px;
      border-radius: 4px;
      background: var(--accent);
      box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent) 50%, transparent);
      display: inline-block;
    }

    aside {
      grid-area: side;
      display: grid;
      grid-template-rows: auto auto auto 1fr auto;
      gap: 14px;
      background: var(--panel-strong);
      border: 1px solid var(--glass-stroke);
      border-radius: 22px;
      padding: 16px;
      overflow: hidden;
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow-1);
    }

   .panel {
      background: color-mix(in srgb, var(--panel) 92%, transparent);
      border: 1px solid var(--glass-stroke);
      border-radius: 18px;
      padding: 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
      display: grid;
      gap: 10px;
    }

   .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }

   .metric {
      background: linear-gradient(150deg,
        color-mix(in srgb, var(--panel-strong) 92%, transparent) 0%,
        color-mix(in srgb, var(--accent) 18%, transparent) 100%);
      border: 1px solid color-mix(in srgb, var(--accent) 32%, transparent);
      border-radius: 16px;
      padding: 12px;
      display: grid;
      gap: 6px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
    }
   .metric h3 { margin: 0; font-size: 12px; color: var(--muted); font-weight: 600; letter-spacing: 0.3px; }
   .metric.val { font-size: 20px; font-weight: 700; line-height: 1.2; color: var(--ink); }
   .metric.val small { display: block; font-size: 11px; font-weight: 500; color: var(--muted); }
   .status-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; }
   .status-label { font-size: 11px; color: var(--muted); font-weight: 600; }

   .scroll { overflow: auto; min-height: 120px; max-height: 50vh; padding-right: 6px; }
   .aspect-list { display: grid; gap: 10px; }

   .aspect-item {
      background: color-mix(in srgb, var(--panel-strong) 90%, transparent);
      border: 1px solid color-mix(in srgb, var(--accent) 22%, transparent);
      border-radius: 16px;
      padding: 12px;
      display: grid;
      gap: 10px;
      transition: transform 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
    }
   .aspect-item:hover { transform: translateY(-2px); border-color: color-mix(in srgb, var(--accent) 45%, transparent); box-shadow: 0 12px 26px rgba(37, 99, 235, 0.18); }
   .aspect-item[aria-selected="true"] { border-color: color-mix(in srgb, var(--focus) 60%, transparent); box-shadow: 0 16px 32px rgba(253, 230, 138, 0.28); }

   .row { display: flex; gap: 10px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
   .row.name { display: inline-flex; align-items: center; gap: 8px; font-weight: 700; font-size: 14px; letter-spacing: 0.25px; }

   .badge {
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
      background: color-mix(in srgb, var(--panel) 80%, transparent);
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent);
    }

   .dot { width: 12px; height: 12px; border-radius: 999px; box-shadow: 0 0 0 2px rgba(255,255,255,0.05); }

   .activation-bar { position: relative; width: 100%; height: 6px; border-radius: 999px; background: color-mix(in srgb, var(--panel) 82%, transparent); overflow: hidden; }
   .activation-bar span { display: block; height: 100%; border-radius: inherit; background: linear-gradient(90deg, rgba(125, 211, 252, 0.85), rgba(168, 85, 247, 0.9)); transition: width 0.2s ease; }

   .tags { display: flex; gap: 6px; flex-wrap: wrap; }
   .tag { font-size: 11px; color: var(--muted); background: color-mix(in srgb, var(--panel-strong) 88%, transparent); border: 1px solid color-mix(in srgb, var(--accent) 18%, transparent); padding: 3px 8px; border-radius: 999px; letter-spacing: 0.2px; }

    label { font-size: 12px; color: var(--muted); font-weight: 600; }

    input[type="range"] { width: 100%; accent-color: var(--accent); }
    
   .input-field { display: grid; gap: 6px; }
   .input-field input,.input-field select {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      padding: 9px 12px;
      color: var(--ink);
      font: inherit;
    }

   .control-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }

   .toggle { display: inline-flex; align-items: center; gap: 10px; font-size: 12px; color: var(--muted); font-weight: 600; }
   .toggle input { position: relative; width: 44px; height: 24px; border-radius: 999px; background: color-mix(in srgb, var(--panel) 80%, transparent); border: 1px solid var(--input-border); cursor: pointer; appearance: none; transition: background 0.2s ease; }
   .toggle input:checked { background: color-mix(in srgb, var(--accent) 45%, transparent); }
   .toggle input::after { content: ''; position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; border-radius: 50%; background: var(--muted); transition: transform 0.2s ease; }
   .toggle input:checked::after { transform: translateX(20px); background: var(--ink); }

   .filter-actions { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
   .empty-state { text-align: center; color: var(--muted); font-size: 13px; padding: 20px; border: 1px dashed color-mix(in srgb, var(--accent) 30%, transparent); border-radius: 14px; }

    footer {
      grid-area: footer;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: color-mix(in srgb, var(--panel) 90%, transparent);
      border: 1px solid var(--glass-stroke);
      padding: 12px 16px;
      border-radius: 18px;
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow-1);
    }

   .vis-hint { color: var(--muted); font-size: 12px; }
   .panel-overlay { display: none; }
    
    /* Dialog styling */
    dialog {
      border: 1px solid var(--glass-stroke);
      border-radius: 20px;
      padding: 0;
      max-width: min(540px, 90vw);
      background: var(--panel-strong);
      color: var(--ink);
      box-shadow: var(--shadow-2);
    }
    dialog::backdrop { background: rgba(15, 23, 42, 0.45); }
   .modal-head { padding: 16px; border-bottom: 1px solid color-mix(in srgb, var(--accent) 25%, transparent); display: flex; align-items: center; justify-content: space-between; gap: 12px; }
   .modal-body { display: grid; gap: 14px; padding: 20px; background: transparent; }
   .modal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
   .modal-grid > div { background: color-mix(in srgb, var(--panel) 90%, transparent); border: 1px solid var(--glass-stroke); border-radius: 14px; padding: 10px; }

    /* AI Response Area */
   .ai-response-box {
      margin-top: 10px;
      padding: 12px;
      background: color-mix(in srgb, var(--accent) 10%, transparent);
      border-radius: 12px;
      border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent);
      font-size: 13px;
      line-height: 1.5;
      min-height: 60px;
    }
   .ai-loading { color: var(--muted); font-style: italic; }

    /* Mobile Layout */
   .mobile-only { display: none!important; }
    @media (max-width: 900px) {
     .mobile-only { display: revert!important; }
      body[data-layout="mobile"].app { display: flex; flex-direction: column; height: auto; }
      body[data-layout="mobile"] aside {
        position: fixed; left: 0; right: 0; bottom: 0; max-height: 86dvh;
        transform: translateY(100%); transition: transform 0.3s ease;
        z-index: 55; border-radius: 24px 24px 0 0; background: var(--panel-strong);
      }
      body[data-layout="mobile"][data-panel="open"] aside { transform: translateY(0); }
      body[data-layout="mobile"].panel-overlay {
        position: fixed; inset: 0; z-index: 50; display: block; opacity: 0; pointer-events: none;
        background: rgba(0,0,0,0.3); transition: opacity 0.3s;
      }
      body[data-layout="mobile"][data-panel="open"].panel-overlay { opacity: 1; pointer-events: auto; }
    }
  </style>
</head>
<body data-layout="desktop" data-panel="open">
  <div class="app" role="application" aria-label="32 Aspect Developmental Self Clock">
    <header>
      <div class="header-top">
        <div class="title-block">
          <h1>32 Aspect Self Clock ¬∑ Gemini AI Powered</h1>
          <p class="subtitle">Interactive Mind‚ÄìBody‚ÄìEnergy atlas with Gemini 2.0 Flash reasoning and Text-to-Speech synthesis.</p>
        </div>
        <div class="mode-toggle" role="group" aria-label="Model lenses">
          <button id="modeMind" class="btn" aria-pressed="true">üß† Mind</button>
          <button id="modeBody" class="btn secondary" aria-pressed="false">ü©∫ Body</button>
          <button id="modeSoul" class="btn secondary" aria-pressed="false">‚ú® Soul</button>
          <button id="btnTheme" class="btn ghost small" type="button">üåô Dark</button>
        </div>
      </div>
      <div class="control-row">
        <div class="control-cluster">
          <button id="btnTutorial" class="btn">‚ñ∂ Tutorial</button>
          <button id="btnRandomize" class="btn secondary">Shuffle</button>
          <button id="btnDeactivate" class="btn warn">Deactivate All</button>
        </div>
        <div class="control-cluster secondary">
          <button id="btnExport" class="btn secondary">Export JSON</button>
          <button id="panelToggle" class="btn ghost small mobile-only">Insights</button>
        </div>
      </div>
    </header>

    <section class="vis">
      <canvas id="clock" tabindex="0"></canvas>
      <div class="legend">
        <div class="chip"><span class="swatch" style="background: var(--accent)"></span> Stage lines (12)</div>
        <div class="chip"><span class="swatch" style="background: var(--accent-2)"></span> Rings (8)</div>
        <div class="chip"><span class="swatch" style="background: #34d399"></span> Resonance</div>
      </div>
    </section>

    <aside id="insightPanel">
      <div class="panel mobile-only">
        <div class="row" style="justify-content: space-between;">
          <strong>Controls</strong>
          <button id="panelClose" class="btn ghost small">Close</button>
        </div>
      </div>
      <div class="panel metrics">
        <div class="metric">
          <h3>SCI (Coherence)</h3>
          <div class="val" id="sciVal">‚Äî</div>
          <span id="sciStatus" class="status-label">Ready.</span>
        </div>
        <div class="metric"><h3>Active Aspects</h3><div class="val" id="activeVal">‚Äî</div></div>
      </div>

      <div class="panel">
        <label for="devStageSlider"><strong>Developmental Stage</strong> <span id="devStageVal">1</span></label>
        <input id="devStageSlider" type="range" min="0" max="11" value="0" />
      </div>

      <div class="panel">
        <div class="input-field">
          <label for="searchInput">Filter Aspects</label>
          <input id="searchInput" type="search" placeholder="Search..." />
        </div>
        <div class="filter-actions" style="margin-top:8px">
          <label class="toggle">
            <input type="checkbox" id="activeOnly" />
            <span>Active Only</span>
          </label>
          <button id="btnResetFilters" class="btn tertiary small">Reset</button>
        </div>
      </div>

      <div class="panel scroll">
        <div id="aspectList" class="aspect-list" role="listbox"></div>
      </div>
    </aside>
    <div class="panel-overlay" id="panelOverlay"></div>

    <footer>
      <div class="vis-hint">Powered by Gemini 2.0 Flash ‚Ä¢ C = E √ó MC methodology</div>
    </footer>
  </div>

  <dialog id="infoModal">
    <div class="modal-head">
      <strong id="mTitle">Aspect</strong>
      <button class="btn" value="cancel">Close</button>
    </div>
    <div class="modal-body">
      <div id="mDef" class="panel"></div>
      <div class="modal-grid">
        <div><strong>Brain/Structure</strong><div id="mBrain"></div></div>
        <div><strong>Neurochemistry</strong><div id="mNT"></div></div>
        <div><strong>Energy Mode</strong><div id="mEnergy"></div></div>
        <div><strong>Stage/Ring</strong><div id="mStage"></div></div>
      </div>
      <div class="panel">
        <label for="mSlider"><strong>Activation Level</strong> <span id="mActVal" style="float:right">0</span></label>
        <input id="mSlider" type="range" min="0" max="100" value="0" />
      </div>
      
      <div class="panel">
        <div class="row" style="justify-content: space-between; margin-bottom: 8px;">
          <strong>Gemini Insight</strong>
          <div class="control-cluster">
             <button id="btnAskGemini" class="btn small" style="background: var(--accent-2); color: white;">‚ú® Analyze</button>
             <button id="btnSpeak" class="btn small secondary" title="Read Aloud">üîä Speak</button>
          </div>
        </div>
        <div id="geminiResponse" class="ai-response-box">
          Click 'Analyze' to generate a developmental insight using Gemini 2.0 Flash.
        </div>
      </div>
    </div>
  </dialog>

  <script>
    /* ============================================================
       CONFIGURATION & API KEYS
       ------------------------------------------------------------
       Replace the placeholder below with your actual Gemini API Key.
       For production, use a proxy to keep this key secure.
    ============================================================ */
    const GEMINI_API_KEY = "[ AIzaSyCP8zAJYPqQ7fOsWvZ2hZeeZRdZn6JBERU ]";
    const GEMINI_MODEL = "gemini-2.0-flash";
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

    /* ============================================================
       DATA MODEL & STATE
    ============================================================ */
    const N_ASPECTS = 32;
    const TWO_PI = Math.PI * 2;
    const center = { x: 0, y: 0 };
    const DEV_STAGES = 12;
    const DEV_STAGE_LABELS =;

    const BIO_LIBRARY = {
      brain: { PFC: "Prefrontal Cortex", Limbic: "Limbic Network", Insula: "Insular Cortex", Amygdala: "Amygdala", Hippocampus: "Hippocampus", ACC: "Anterior Cingulate", "Basal Ganglia": "Basal Ganglia", Cerebellum: "Cerebellum" },
      nt: { "5-HT": "Serotonin", DA: "Dopamine", NE: "Norepinephrine", GABA: "GABA", ACh: "Acetylcholine", Oxytocin: "Oxytocin", Endorphins: "Endorphins" },
      modes: { visual: "Visual", auditory: "Auditory", interoceptive: "Interoceptive", proprioceptive: "Proprioceptive", vestibular: "Vestibular", somatic: "Somatic" }
    };

    let mode = 'mind';
    let aspects =;
    const state = {
      focusId: 1,
      devStage: 0,
      filterText: '',
      activeOnly: false,
      theme: 'dark',
      layout: 'desktop',
      panelOpen: true,
      currentVoice: null
    };

    // Helper: Generate Mock Data
    function makeAspectSet(modelType) {
      const arr =;
      const BRAIN = Object.keys(BIO_LIBRARY.brain);
      const NT = Object.keys(BIO_LIBRARY.nt);
      for(let i=0; i<N_ASPECTS; i++) {
        const stage = 1 + (i % 12);
        const ring = 1 + (i % 8);
        arr.push({
          id: i+1,
          name: `${modelType.charAt(0).toUpperCase() + modelType.slice(1)} Aspect ${i+1}`,
          stage, ring,
          activation: Math.floor(Math.random() * 20), // random baseline
          hue: Math.round((i * (360 / N_ASPECTS)) % 360),
          definition: `Definitions for ${modelType} aspect ${i+1}.`,
          brainRegion: BRAIN,
          neurotransmitter: NT,
          energyMode: "Somatic"
        });
      }
      return arr;
    }

    const datasets = {
      mind: makeAspectSet('mind'),
      body: makeAspectSet('body'),
      soul: makeAspectSet('soul')
    };
    aspects = datasets.mind;

    /* ============================================================
       DOM ELEMENTS
    ============================================================ */
    const el = s => document.querySelector(s);
    const canvas = el('#clock');
    const ctx = canvas.getContext('2d');
    const listEl = el('#aspectList');
    const modal = el('#infoModal');
    const geminiBox = el('#geminiResponse');
    const btnAskGemini = el('#btnAskGemini');
    const btnSpeak = el('#btnSpeak');

    /* ============================================================
       GEMINI API INTEGRATION
    ============================================================ */
    async function callGemini(aspect) {
      if (!GEMINI_API_KEY |

| GEMINI_API_KEY.includes("insert")) {
        geminiBox.textContent = "‚ö†Ô∏è Error: Please insert a valid Gemini API Key in the code.";
        return;
      }

      geminiBox.innerHTML = '<span class="ai-loading">Contacting Gemini 2.0 Flash...</span>';
      
      const systemPrompt = "You are the 32-Aspect Developmental Self Clock assistant. Analyze the user's aspect activation within the context of the Mind-Body-Energy ontology. Be concise, insightful, and therapeutic.";
      
      const userPrompt = `
        Analyze this aspect:
        Name: ${aspect.name}
        Model Mode: ${mode.toUpperCase()}
        Activation Level: ${aspect.activation}/100
        Developmental Stage: ${DEV_STAGE_LABELS[aspect.stage - 1]} (Stage ${aspect.stage})
        Brain Region: ${aspect.brainRegion}
        Neurotransmitter: ${aspect.neurotransmitter}
        
        Provide a 2-sentence insight on what this activation level implies for the user's developmental trajectory.
      `;

      const payload = {
        systemInstruction: { parts: [{ text: systemPrompt }] },
        contents: [{ role: "user", parts: [{ text: userPrompt }] }],
        generationConfig: {
          temperature: 0.7,
          maxOutputTokens: 150
        }
      };

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error(`API Error: ${response.status}`);

        const data = await response.json();
        const aiText = data.candidates?.?.content?.parts?.?.text |

| "No response generated.";
        
        geminiBox.textContent = aiText;
        
        // Auto-speak feature (optional, can be disabled)
        // speakText(aiText); 

      } catch (err) {
        console.error(err);
        geminiBox.textContent = "Error communicating with Gemini. Check console.";
      }
    }

    /* ============================================================
       TEXT-TO-SPEECH (WEB SPEECH API)
    ============================================================ */
    function initSpeech() {
      const loadVoices = () => {
        const voices = window.speechSynthesis.getVoices();
        // Prefer a clear English voice
        state.currentVoice = voices.find(v => v.name.includes("Google US English")) |

| 
                             voices.find(v => v.lang.startsWith("en")) |

| 
                             voices;
      };
      if (window.speechSynthesis.onvoiceschanged!== undefined) {
        window.speechSynthesis.onvoiceschanged = loadVoices;
      }
      loadVoices();
    }

    function speakText(text) {
      if (!window.speechSynthesis) return;
      window.speechSynthesis.cancel(); // Stop previous
      const u = new SpeechSynthesisUtterance(text);
      if (state.currentVoice) u.voice = state.currentVoice;
      u.rate = 1.0;
      u.pitch = 1.0;
      window.speechSynthesis.speak(u);
    }

    btnSpeak.addEventListener('click', () => {
      const text = geminiBox.textContent;
      if (text &&!text.includes("...")) speakText(text);
    });

    /* ============================================================
       VISUALIZATION & UI LOGIC
    ============================================================ */
    function resizeCanvas() {
      const dpr = window.devicePixelRatio |

| 1;
      canvas.width = canvas.clientWidth * dpr;
      canvas.height = canvas.clientHeight * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      draw();
    }

    function draw() {
      const w = canvas.clientWidth, h = canvas.clientHeight;
      ctx.clearRect(0, 0, w, h);
      const cx = w/2, cy = h/2;
      const maxR = Math.min(w, h)/2 - 20;

      // Draw Rings
      for(let i=1; i<=8; i++) {
        ctx.beginPath();
        ctx.arc(cx, cy, (maxR/8)*i, 0, TWO_PI);
        ctx.strokeStyle = 'rgba(100,100,255,0.1)';
        ctx.stroke();
      }

      // Draw Nodes
      aspects.forEach((a, i) => {
        const ang = (i / N_ASPECTS) * TWO_PI - Math.PI/2;
        const r = (maxR/8) * a.ring; // simple mapping
        const x = cx + Math.cos(ang) * (maxR * 0.9);
        const y = cy + Math.sin(ang) * (maxR * 0.9);

        // Link lines
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(x, y);
        ctx.strokeStyle = 'rgba(100,100,255,0.05)';
        ctx.stroke();

        // Node
        ctx.beginPath();
        ctx.arc(x, y, 6 + (a.activation/10), 0, TWO_PI);
        ctx.fillStyle = `hsl(${a.hue}, 70%, 50%)`;
        ctx.fill();
        
        if (state.focusId === a.id) {
          ctx.lineWidth = 3;
          ctx.strokeStyle = '#fff';
          ctx.stroke();
        }
      });
    }

    function buildList() {
      listEl.innerHTML = '';
      aspects.forEach(a => {
        if (state.activeOnly && a.activation === 0) return;
        if (state.filterText &&!a.name.toLowerCase().includes(state.filterText.toLowerCase())) return;

        const div = document.createElement('div');
        div.className = 'aspect-item';
        div.innerHTML = `<div class="row"><strong>${a.name}</strong> <small>Val: ${a.activation}</small></div>
                         <div class="activation-bar"><span style="width:${a.activation}%"></span></div>`;
        div.onclick = () => openModal(a);
        listEl.appendChild(div);
      });
      el('#activeVal').textContent = aspects.filter(a => a.activation > 0).length;
    }

    function openModal(a) {
      state.focusId = a.id;
      el('#mTitle').textContent = a.name;
      el('#mBrain').textContent = a.brainRegion;
      el('#mNT').textContent = a.neurotransmitter;
      el('#mEnergy').textContent = a.energyMode;
      el('#mStage').textContent = `${a.stage} ¬∑ Ring ${a.ring}`;
      el('#mActVal').textContent = a.activation;
      el('#mSlider').value = a.activation;
      
      // Reset Gemini Box
      geminiBox.textContent = "Click 'Analyze' for Gemini insight.";
      
      // Bind Gemini Button
      btnAskGemini.onclick = () => callGemini(a);
      
      // Bind Slider
      el('#mSlider').oninput = (e) => {
        a.activation = parseInt(e.target.value);
        el('#mActVal').textContent = a.activation;
        buildList();
        draw();
      };

      modal.showModal();
      draw();
    }

    // Event Listeners
    window.addEventListener('resize', resizeCanvas);
    el('#modeMind').onclick = () => { mode='mind'; aspects=datasets.mind; buildList(); draw(); };
    el('#modeBody').onclick = () => { mode='body'; aspects=datasets.body; buildList(); draw(); };
    el('#modeSoul').onclick = () => { mode='soul'; aspects=datasets.soul; buildList(); draw(); };
    el('#searchInput').oninput = (e) => { state.filterText = e.target.value; buildList(); };
    el('#activeOnly').onchange = (e) => { state.activeOnly = e.target.checked; buildList(); };
    el('#btnTheme').onclick = () => {
      state.theme = state.theme === 'light'? 'dark' : 'light';
      document.body.setAttribute('data-theme', state.theme);
    };
    
    // Modal Close
    modal.querySelector('button[value="cancel"]').onclick = () => modal.close();
    el('#panelClose').onclick = () => { document.body.setAttribute('data-panel', 'closed'); };
    el('#panelToggle').onclick = () => { document.body.setAttribute('data-panel', 'open'); };

    // Init
    initSpeech();
    resizeCanvas();
    buildList();
    document.body.setAttribute('data-theme', state.theme);

  </script>
</body>
</html>
